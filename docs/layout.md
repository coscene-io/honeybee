# 可视化布局优化

## 修改记录

## 背景

##### 1. 布局存储与关联混乱： 共享布局需先共享到组织，再到项目中开启推荐，关联起来饶了一大圈。

##### 2. 选择布局低效： 可视化布局枚举过多时，用戶难以知道是否有推荐布局，需手动点开查看与切换。

##### 3. 布局协同场景下难以追溯： 布局的最后修改人信息缺失，不利于协同场景下的责任追溯与版本管

##### 控。

```
4. 交互缺陷： 切换tab等操作会保存到个人布局，干扰用戶下一次进入可视化；进入可视化⻚面时，
未引导用戶切换推荐布局，正确的布局触达率低；布局删除缺乏友好提示，易引发用戶误操作焦
虑。
5. 层级与设备适配不足： 设备侧对项目布局的支持不完善，设备实时可视化过程中难以辨识合适的布
局；布局未覆盖项目层级需求，无法满足不同项目的差异化管理；同时，组织布局概念冗余，增加
系统复杂度与维护成本。
```

## 设计概要

##### 1. 改版后，布局分为2种类型 ：个人、项目

##### 2. 在可视化中切换布局时 ：使用弹窗承载可视化布局，有层级结构的管理

##### 3. 创建布局时： 支持从别的项目选择拷⻉

##### 4. 布局存储： 数据库里

##### 5. 布局展示的优先顺序 ：

```
a. 记录回放、设备实时可视化、公开项目回放：上次在本项目使用的个人/项目布局，若没有使用
过，弹窗选择布局
6. 有项目布局时，自动推荐： 详⻅下文的提醒机制链路
7. 明显的布局保存按钮 ：布局变更后，在顶部有明显的保存/撤销按钮
8. 布局被删除时，有友好的提示
a. 当用戶正在用着被删掉的布局时，先提示用戶，再刷新为默认布局/基于当前创建个人布局
b. 删除布局时的二次提醒，告知影响
9. 增加布局信息 ：更新人、更新时间
10. coStudio未登录时： 创建的个人布局，在登录后同步到个人布局中
11. 历史数据 ：将现有的组织布局拷⻉一份到各个项目中，作为项目布局
```

## 设计稿，看 08 - 13 版本

https://www.figma.com/design/29i5wgH0ZD02USBwJktjF7/coScene-Web-2025?node-id=3731-
15691&t=U8udOWkegJPaRFOD-4

## 需求描述

### 去掉组织布局的概念

##### 1. 数据迁移，将组织中的所有布局，拷⻉一份到项目中，作为项目布局

```
2. 在组织设置中，将可视化布局配置的入口tab删掉
```

### 在可视化中管理布局

#### 1. 删除「项目设置-可视化布局配置」tab入口

#### 2. 在可视化的布局切换处，展示当前布局类型+布局名称

##### 1. 布局类型枚举：个人布局、项目布局

```
a. 为空时，上面展示为「布局」，下面同现状
```

#### 3. 点击布局处，展开布局抽屉

##### 1. 左侧显示布局的层级结构

a. 个人布局、个人布局下的文件夹
b. 项目布局、项目布局下的文件夹 2. 点击【创建布局】先下拉让用戶选择创建方式
a. 创建空白布局

b. 从其他项目复制布局
c. 本地文件导入3. 点击【创建空白布局】，弹出创建窗口
a. 布局名称，必填，输入框
b. 类型：个人布局、项目布局
c. 文件夹位置：创建新文件夹+枚举值为个人/项目布局中的文件夹名称
d. 选择创建新文件夹，多一行输入框，输入新文件夹名称
e. 点击【确定】按钮后，进入到⻚面中，让用戶自行配置布局，并在顶部有【保存按钮】

##### 4. 点击【从其他项目复制布局】，弹出窗口

```
a. 选择项目：当前登录用戶可⻅的项目，默认选为当前项目
b. 要复制的布局：必选，单选，分组的枚举，支持按照布局名称搜索，根据选择的目标项目，变
化枚举值，包含文件夹名+布局名
c. 其余内容同创建空白布局
```

##### 5. 点击【从本地文件导入】

```
a. 优先调出系统弹窗，供用戶选择一个本地文件，选择后，展开以下弹窗
b. 展示已经选择的布局文件
c. 支持删掉文件重新选择，删掉文件时，确定按钮为禁用状态
d. 选择类型
e. 文件夹位置
f. 创建后，布局名称同本地文件的名称
g. 文件名字重名时，依然创建出来同名布局文件
```

##### 6. 右侧显示所在位置的布局内容

```
a. 面包屑展示当前所在位置
b. 模糊搜索布局名称
c. 更新时间：时间范围选择器，快捷筛选：今天、3天、30天、近1年、本周、本月
d. 布局内容
i. 缩略图（P2），在布局点击保存时，自动截取当时的屏幕覆盖旧的缩略图
ii. 布局名称，默认聚焦，自动填写为原布局名
iii. 布局类型
iv. 最后更新人及时间，颗粒度到天即可
v. 若当前布局并未使用，展示为【使用】【更多】按钮
vi. 点击【使用】退出可视化布局抽屉，⻚面自动切换为对应布局
vii. 若当前布局正在使用中，有【使用中】的标签
viii. 若布局存在未保存的内容，展示【保存更改】【撤销更改】按钮
ix. 在【更多】按钮中包含：重命名、复制为个人布局、复制为项目布局、导出、删除
x. 复制为个人布局、复制为项目布局时，弹出窗口，让用戶填写布局名称、文件夹位置
xi. 在文件夹位置枚举值：同创建一致
```

##### 7. 若所在的个人布局、项目布局无内容时，展示为缺省⻚

```
a. 若将文件夹里的最后一条布局删除，那么同步删除这个文件夹，因此，文件夹不会有缺省状态
```

#### 4. 删除布局

##### 1. 删除个人布局：删除 布局名称 后，你将无法再次使用，确认删除？

##### 2. 删除项目布局：删除 布局名称 后，本项目内的用戶将无法使用此布局，确认删除？

##### 3. 点击【取消】，关闭窗口

##### 4. 点击【删除】，关闭窗口

```
a. 操作删除的人⻚面轻提示：布局已删除
b. 布局可选项直接从项目布局列表中消失
c. 下次项目组成员进入可视化时，根据布局展示顺序逻辑使用
d. 若有人同时在使用同一布局查看记录，用戶点击保存有提示
e. 支持使用另存为，调出创建空白布局的窗口
```

#### 5. 调整布局的保存询问

##### 1. 若用戶在可视化中，直接调整了当前布局，在当前布局处出现【保存】【撤销】按钮

```
a. 若用戶没有保存布局的改动，直接关闭浏览器/退出coStudio，保留他的上一次改动，即下次
进入使用该布局，还是上次改完后的样子，但要有保存和撤销按钮
```

```
b. 创建空白个人布局时
i. 点击按钮，先弹窗让用戶填写个人布局名称，点击确认后再关闭弹窗进入空白让用戶配置自
己的面板
ii. 用戶可点击右上⻆处的【保存】按钮来保存布局
iii. 右上⻆无【撤销】按钮
iv. 当点击一次【保存】按钮后，后续才会出现【撤销】按钮，用来撤回到上次保存状态
c. 点击保存、撤销按钮，对当前布局生效
i. 个人布局：点击保存，轻提示用戶：布局保存成功
ii. 项目布局：点击保存，二次提醒用戶，支持另存为
iii. 点击撤销按钮，二次询问用戶
```

```
d. 修改布局保存触发机制
i. 在选项卡面板，切换选中的tab，不触发保存/撤销操作
ii. 在三维面板，放大缩小视图，不触发保存/撤销操作
```

#### 6. 布局存储： 数据库里

### 布局展示的优先顺序

```
1. 适用场景：记录回放、设备实时可视化、公开项目记录回放、coStudio的文件播放
2. 最优先：上次在本项目使用的个人/项目布局
3. 次优先：若都没有使用过，进入可视化⻚面后，自动展开可视化布局选择窗口
```

### 有更合适的布局提醒机制

##### 系统提醒，从屏幕右上⻆从右往左划出

##### 1. 推送有项目布局可用

```
a. 推送时机，在进入可视化，5秒内
b. 点击保持现状，关闭提醒窗
c. 点击立即切换，切换至对应布局类型的第一个
```

##### 2. 推荐方式如下图

## 数据迁移

### 个人布局

##### 1. 跟着个人账号走

##### 2. 迁移至可视化布局抽屉中的【个人布局】分类下

##### 3. 个人布局，不管登录在哪个组织、哪个项目、查看公开项目，都可看到、可使用、可管理

### 组织布局迁移成项目布局

##### 1. 将已有的组织布局迁移成项目布局

##### 2. 例：组织内有10条组织布局，将这10条组织布局分别复制到各个项目中，成为项目布局

##### 3. 更新时间取最后的保存时间，人取创建者

##### 4. 迁移后的布局，保持可用状态

### 记录推荐布局

##### 1. 将已有的记录推荐布局删除

## 布局的复制

##### 1. 当用戶在使用「创建项目-从已有项目复制」时，将可视化布局配置拆出为一个可选项

##### 2. 勾上后，完整复制该项目的项目布局，包括文件层级结构

## 公开项目相关

##### 1. 修改下图的弹窗文案：

```
a. 标题：无项目布局
b. 内容：
c. 当前未设置项目布局，用戶可能无法找到合适的布局可视化数据；
d. 设置项目布局后，公开项目播放记录时可优先使用项目布局进行可视化；
e. 可前往记录可视化回放中，从右上⻆「布局」中选择一条布局复制为项目布局。
```

##### 2. 游客身份，在查看公开项目的记录回放时，默认使用项目布局

```
a. 游客可以在项目布局中进行微调、添加面板等方式观看记录，但顶部不出现【保存】/【撤销】
按钮
b. 游客可以使用自己的个人布局进行查看，支持保存
```

## coStudio相关改造

##### 1. 布局的优化改造同上述需求

```
2. 当coStudio未登录是，仅支持用戶创建个人布局（即创建时的类型选择无法选择「项目布
局」），创建的流程同web端
a. 在布局配置完成后，点击【保存】按钮时，⻚面轻提示：请先登录后才可以保存
b. 下次打开coStudio依然保持着没有保存的布局
```

## 08 - 12 对⻬

```
1. 推荐布局时，判断布局的topic是否能够显示记录中已有的topic（以后迭代版）
2. 上次在本项目使用的个人/项目布局，若没有使用过，弹窗选择布局
3. 仅保留个人布局、项目布局
a. 干掉组织布局： 我们更推荐用戶在项目中做统一管理，每个项目各管各的，避免在一个项目中
选择组织布局权限问题、降低因组织布局各个项目配置不同引发的错选概率，迁移为项目布
局，确保用戶布局不丢失，慢慢提升项目中可视化布局盲选即对的概率
```

b. **干掉记录布局：** 我们更推荐的用法是把相似的记录、类似场景的记录放在同一个项目中，对于
特殊的记录，并不推荐放在与其完全不同内容的项目里。再者，用戶即使对一条特殊的记录配
置一个布局，也大概率不会设定为记录布局，因为会保存为个人布局，如果有复用情况他设为
项目布局也能用。 4. 创建布局时，支持从别的项目选择拷⻉ 5. 布局存在数据库里 6. 在可视化中切换布局时，使用弹窗，里面做管理，有层级结构 7. 明显的保存按钮，但仍然有缓存机制 8. coStudio未登录时，创建的个人布局，在登录后同步到个人布局中
